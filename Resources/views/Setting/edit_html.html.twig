<script type="text/javascript">
    require(['jquery', 'ckeditor'], function($){
        jQuery(document).ready(function($){

            var id = 'bfos_settingsmanagementbundle_setting_type_value';

            $('form.js_update_form').bind('prePost', function(e){
                $('#'+id).val(window.CKEDITOR.instances[id].getData());
            });

            if (window.CKEDITOR.instances[id])
            {
                delete window.CKEDITOR.instances[id];
            }
            CKEDITOR.replace(id, {
                toolbar :
                        [
                            { name: 'basicstyles', items : [ 'Bold','Italic','Strike','-','RemoveFormat' ] },
                            { name: 'paragraph', items : [ 'NumberedList','BulletedList','-','Outdent','Indent','-','Blockquote' ] },
                            { name: 'links', items : [ 'Link','Unlink','Anchor' ] },
                            { name: 'docs', items : [ 'Source' ] }
                        ]
            });
            window.CKEDITOR.instances[id].on('instanceReady', function (evt)
            {
                var editor = evt.editor;
                // http://cksource.com/forums/viewtopic.php?p=48574#p48574
                if (window.CKEDITOR.env.webkit && parseInt(editor.config.width) < 310)
                {
                    var iframe = document.getElementById('cke_contents_' + editor.name).firstChild;
                    iframe.style.display = 'none';
                    iframe.style.display = 'block';
                }
            });
        });
    });
</script>
